var gdjs;(function(n){const h=(c,i,t)=>{const e=c.first;e.value=i,e.next=e.next||{time:1,value:0},e.next.value=t},l=class{constructor(i,t,e){this.started=!1;this.helperGraphics=null;this.runtimeObject=t;const r=i.getGame().getRenderer().getPIXIRenderer(),s=i.getGame().getImageManager();let a=PIXI.Texture.WHITE;r&&(e.rendererType==="Point"?a=s.getOrCreateDiskTexture(e.rendererParam1,r):e.rendererType==="Line"?a=s.getOrCreateRectangleTexture(e.rendererParam1,e.rendererParam2,r):e.textureParticleName?a=s.getOrCreateScaledTexture(e.textureParticleName,e.rendererParam1,e.rendererParam2,r):a=s.getOrCreateRectangleTexture(e.rendererParam1,e.rendererParam2,r));const o={ease:void 0,emit:void 0,lifetime:{min:e.particleLifeTimeMin,max:e.particleLifeTimeMax},frequency:e.flow<0?l.frequencyMinimumValue:1/e.flow,spawnChance:1,particlesPerWave:e.flow<0?e.maxParticleNb:1,maxParticles:e.maxParticleNb,emitterLifetime:l.computeLifetime(e.flow,e.tank),pos:{x:0,y:0},addAtBack:!1,behaviors:[{type:"alpha",config:{alpha:{isStepped:!1,list:[{time:0,value:e.particleAlpha1/255},{time:1,value:e.particleAlpha2/255}]}}},{type:"moveAcceleration",config:{accel:{x:e.particleGravityX,y:e.particleGravityY},minStart:e.emitterForceMin,maxStart:e.emitterForceMax,rotate:e.particleAngle1===0&&e.particleAngle2===0&&(e.particleGravityX!==0||e.particleGravityY!==0||e.emitterForceMin<0||e.emitterForceMax<0)}},{type:"scale",config:{scale:{isStepped:!1,list:[{time:0,value:e.particleSize1/100*(1+e.particleSizeRandomness1/100)},{time:1,value:e.particleSize2/100*(1+e.particleSizeRandomness2/100)}]}}},{type:"color",config:{color:{isStepped:!1,list:[{time:0,value:n.rgbToHex(...n.rgbOrHexToRGBColor(e.particleColor1))},{time:1,value:n.rgbToHex(...n.rgbOrHexToRGBColor(e.particleColor2))}]}}},{type:"rotation",config:{accel:0,minStart:-e.emitterAngleB/2,maxStart:e.emitterAngleB/2,maxSpeed:e.particleAngle2,minSpeed:e.particleAngle1}},{type:"blendMode",config:{blendMode:e.additive?"ADD":"NORMAL"}},{type:"textureSingle",config:{texture:a}},{type:"spawnShape",config:{type:"torus",data:{affectRotation:!1,innerRadius:0,radius:e.zoneRadius,x:0,y:0}}}]};this.renderer=new PIXI.Container,this.emitter=new PIXI.particles.Emitter(this.renderer,o),this.start();const p=i.getLayer(t.getLayer());p&&p.getRenderer().addRendererObject(this.renderer,t.getZOrder())}getRendererObject(){return this.renderer}update(i){if(!this.runtimeObject.getInstanceContainer().getGame().isInGameEdition()){const t=this.emitter.emit;this.emitter.update(i),!this.started&&t&&(this.started=!0)}if(this.helperGraphics){this.helperGraphics.clear(),this.helperGraphics.position.x=this.runtimeObject.getX(),this.helperGraphics.position.y=this.runtimeObject.getY();const t=n.toRad(this.runtimeObject.getAngle()),e=n.toRad(this.runtimeObject.getConeSprayAngle()),r=t-e/2,s=t+e/2,a=64;this.helperGraphics.beginFill(0,0),this.helperGraphics.lineStyle(3,this.runtimeObject.getParticleColorEnd(),1),this.helperGraphics.moveTo(0,0),this.helperGraphics.lineTo(Math.cos(r)*a,Math.sin(r)*a),this.helperGraphics.moveTo(0,0),this.helperGraphics.lineTo(Math.cos(s)*a,Math.sin(s)*a),this.helperGraphics.endFill(),this.helperGraphics.lineStyle(0,0,1),this.helperGraphics.beginFill(this.runtimeObject.getParticleColorStart()),this.helperGraphics.drawCircle(0,0,8),this.helperGraphics.endFill()}}setPosition(i,t){this.emitter.spawnPos.x=i,this.emitter.spawnPos.y=t}setAngle(i,t){const e=this.emitter.getBehavior("rotation");e.minStart=n.toRad(i),e.maxStart=n.toRad(t)}setForce(i,t){const e=this.emitter.getBehavior("moveAcceleration");e.maxStart=t||1e-6,e.minStart=i}setZoneRadius(i){const t=this.emitter.getBehavior("spawnShape");t.shape.radius=i}setLifeTime(i,t){this.emitter.minLifetime=i,this.emitter.maxLifetime=t}setGravity(i,t){const e=this.emitter.getBehavior("moveAcceleration");e.accel.x=i,e.accel.y=t,this._updateRotateFlagFromSpeed()}_updateRotateFlagFromSpeed(){const i=this.emitter.getBehavior("rotation"),t=this.emitter.getBehavior("moveAcceleration");t.rotate=i.minSpeed===0&&i.maxSpeed===0&&(t.accel.x!==0||t.accel.y!==0||t.minStart<0||t.maxStart<0)}setColor(i,t){const r=this.emitter.getBehavior("color").list.first;{const[s,a,o]=n.hexNumberToRGBArray(i);r.value.r=s,r.value.g=a,r.value.b=o}r.next=r.next||{time:1,value:{}};{const[s,a,o]=n.hexNumberToRGBArray(t);r.next.value.r=s,r.next.value.g=a,r.next.value.b=o}}setSize(i,t){const e=this.emitter.getBehavior("scale");h(e.list,i/100,t/100)}setParticleRotationSpeed(i,t){const e=this.emitter.getBehavior("rotation");e.minSpeed=n.toRad(i),e.maxSpeed=n.toRad(t),this._updateRotateFlagFromSpeed()}setMaxParticlesCount(i){this.emitter.maxParticles=i}setAdditiveRendering(i){const t=this.emitter.getBehavior("blendMode");t.value=i?"ADD":"NORMAL"}setAlpha(i,t){const e=this.emitter.getBehavior("alpha");h(e.list,i/255,t/255)}setFlow(i,t){this.emitter.frequency=i<0?l.frequencyMinimumValue:1/i,this.emitter.emitterLifetime=l.computeLifetime(i,t)}resetEmission(i,t){this.setFlow(i,t);const e=this.emitter.emit;this.start(),e||this.stop()}isTextureNameValid(i,t){const e=t.getGame().getImageManager().getInvalidPIXITexture(),r=t.getGame().getImageManager().getPIXITexture(i);return r.valid&&r!==e}setTextureName(i,t){const e=t.getGame().getImageManager().getInvalidPIXITexture(),r=t.getGame().getImageManager().getPIXITexture(i);if(r.valid&&r!==e){const s=this.emitter.getBehavior("textureSingle");s.texture=r}}getParticleCount(){return this.emitter.particleCount}stop(){this.emitter.emit=!1}start(){this.emitter.emit=!0}recreate(){this.emitter.cleanup()}destroy(){this.emitter.destroy()}hasStarted(){return this.started}_mayHaveEndedEmission(){return this.emitter.frequency>l.frequencyMinimumValue&&this.emitter.emitterLifetime>=0&&!this.emitter.emit&&this.emitter._emitterLife===this.emitter.emitterLifetime}static computeLifetime(i,t){return t<0?-1:i<0?.001:(t+.1)/i}setHelperVisible(i){i&&!this.helperGraphics?(this.helperGraphics=new PIXI.Graphics,this.renderer.addChild(this.helperGraphics)):!i&&this.helperGraphics&&(this.helperGraphics.removeFromParent(),this.helperGraphics.destroy(),this.helperGraphics=null)}};let m=l;m.frequencyMinimumValue=1e-4,n.ParticleEmitterObjectPixiRenderer=m,n.ParticleEmitterObjectRenderer=m})(gdjs||(gdjs={}));
//# sourceMappingURL=particleemitterobject-pixi-renderer.js.map
